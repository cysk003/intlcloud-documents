ここでは、コンソールを介してMySQLインスタンスのbinlog保留周期を設定する方法をご紹介します。
>?
>- 1ノードのクラウドディスクインスタンスはローカルbinlogの保存設定をサポートしていません。
>- マスターインスタンスの下に災害復旧インスタンスが存在する場合、ローカルのbinlogの保持時間が120時間を下回ることはできません。 

## binlogの説明
TencentDB for MySQLインスタンスでは、大きなタスクまたは大量のDMLを実行する際に、たくさんのbinlogが発生します。binlogの書き込みが256MBに達すると1回分割され、分割した後のbinlogファイルはCloud Object Storage（COS）にアップロードされます。その後コンソールのログリストに、COSにアップロードされたbinlogファイルが表示されます。
![](https://main.qcloudimg.com/raw/bcf3d0d2ac291ccebbcfebea05fd11f1.png)

## 概要
binlogはCOSにアップロードされる前に、一時的にインスタンスのディスクに保存されるため、ディスク使用容量が増加します。お客様は、コンソールにてBinlog保留周期を設定して占有容量の比率を制御することも、またディスク容量を拡張することも可能です。ディスク使用率を80%以下にすることを推奨し、その次に、不要なデータの速やかな消去を推奨します。
- binlogは、MySQLのデータ同期のベースであり、データベースの復元性、安定性、高可用性を保障するために使用されます。TencentDB for MySQLではbinlogの無効化をサポートしていません。
- 生成されたbinlogはまずシステムの[自動バックアップ機能](https://intl.cloud.tencent.com/document/product/236/37796)によってCOSにバックアップされ、バックアップ後のbinlogは、設定したローカルのbinlog保留ポリシーに従い削除されます。エラーを防止するため、現在使用中のbinlogを消去することはできません。このため、消去のプロセスでは一定の遅延が発生します。設定した後はしばらくお待ちください。
>?期限切れbinlogログのクリーンアップルール：
>60秒ごとにローカルbinlogログを確認し、binlogの開始時間または使用容量が設定済みの保存ルールを満たさない場合、「削除待ち」キューに追加されます。「削除待ち」キューにあるbinlogは時系列で並べ替えられ、「削除待ち」キューがクリーンアップされるまで、最も古いbinlogから順に1つずつ削除されます。

## 操作手順
1. [MySQLコンソール](https://console.cloud.tencent.com/cdb)にログインし、インスタンスリストページのインスタンスIDをクリックして、インスタンス管理ページに進みます。
2. インスタンス管理ページで、**バックアップ復元**ページを選択し、**ローカルBinlog設定**をクリックします。
3. ポップアップしたダイアログボックスに、必要な保存時間と容量使用率を入力し、間違いがないことを確認してから、**確定**をクリックします。
![](https://staticintl.cloudcachetci.com/yehe/backend-news/e5xL948_37.png)

## よくあるご質問
#### ローカルbinlogの保留設定が小さすぎるとデータベースの復元に影響しませんか。
影響しません。生成されたbinlogは自動バックアップ機能によって迅速にCOSにアップロードされます。アップロードされていないbinlogも消去されませんが、ローカルbinlogの保留設定が小さすぎるとロールバックの速度に影響します。適宜設定してください。

#### ローカルbinlog保留のデフォルトの設定時間はどのくらいですか？
ローカルのbinlogのデフォルトの保存時間：120時間。デフォルトのスペース使用率は30%以下とします。必要に応じて、ローカルのbinlogの保存時間を設定できます。マスターインスタンスの下に災害復旧インスタンスが存在する場合、120時間を下回ることはできません。マスターインスタンスの下に災害復旧インスタンスが存在しない場合、保持時間を72～168時間に設定できます。

#### binlogがインスタンスのディスク容量を占有することはありますか？
あります。生成されたbinlogはまずCOSに自動バックアップされ、バックアップ後のbinlogは設定された保留ポリシーに従って削除されます。この期間、binlogは一時的にインスタンスのディスクに保存されます。
